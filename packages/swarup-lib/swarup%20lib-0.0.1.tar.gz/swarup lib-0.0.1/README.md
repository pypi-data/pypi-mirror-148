The following is just a rough implementation.