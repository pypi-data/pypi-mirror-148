version: 2

sources:
{%- for source in sources.values() -%}
{%- set schema_name='zzzsrc_' ~ source.name | lower() %}
  - name: {{source.name}}
    description: '{{source.description | replace("\n","")}}'
    schema: {{schema_name}}
    tables:
{%- for interface in source.interfaces%}
      - name: {{interface.name}}
        description: '{{interface.comment | replace("\n","")}}'
        columns:
{%- for column in interface.columns%}
        - name: {{column.name}}
          description: '{{column.comment | replace("\n","")}}'
{%-if interface.primary_key.columns.values() and column.name==interface.primary_key.columns.values()[0].name %}
          tests:
            - unique
            - not_null          
{%- endif %}
{%- endfor %}
{%- endfor -%}
{%- endfor -%}
