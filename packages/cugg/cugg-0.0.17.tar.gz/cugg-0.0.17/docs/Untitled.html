---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/Untitled.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/Untitled.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Summary-statistics-merger">Summary statistics merger<a class="anchor-link" href="#Summary-statistics-merger"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">Bio.Seq</span> <span class="kn">import</span> <span class="n">Seq</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../xqtl-pipeline/pipeline/misc/data/yml_list.txt&#39;</span><span class="p">,</span><span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[0, &#39;./data/template.yml&#39;]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merge_sumstats</span><span class="p">(</span><span class="s1">&#39;../xqtl-pipeline/pipeline/misc/data/template.yml&#39;</span><span class="p">,</span><span class="n">keep_ambiguous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Total number of sumstats:  4
{&#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps500_flip_rea0a1.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}, &#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps500_rea0a1.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}, &#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps500.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}, &#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps1000.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}}
../xqtl-pipeline/pipeline/misc/data/testflip/snps500_flip_rea0a1.regenie.snp_stats.gz {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}
../xqtl-pipeline/pipeline/misc/data/testflip/snps500_rea0a1.regenie.snp_stats.gz {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}
../xqtl-pipeline/pipeline/misc/data/testflip/snps500.regenie.snp_stats.gz {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}
../xqtl-pipeline/pipeline/misc/data/testflip/snps1000.regenie.snp_stats.gz {&#39;ID&#39;: &#39;CHR,POS&#39;, &#39;CHR&#39;: &#39;CHR&#39;, &#39;POS&#39;: &#39;POS&#39;, &#39;A0&#39;: &#39;REF&#39;, &#39;A1&#39;: &#39;ALT&#39;, &#39;SNP&#39;: &#39;SNP&#39;, &#39;STAT&#39;: &#39;BETA&#39;, &#39;SE&#39;: &#39;SE&#39;, &#39;P&#39;: &#39;P&#39;}
Total rows of query:  500 Total rows of subject:  500
Overlap chr:pos 500
              sign_flip  strand_flip  exact_match
1:18744859         True         True        False
1:19112524         True         True        False
1:19112744         True         True        False
1:19220870         True         True        False
1:19324561         True         True        False
...                 ...          ...          ...
10:91959301        True         True        False
10:93074445        True         True        False
10:94171346        True         True        False
10:100293231       True         True        False
10:101803994       True         True        False

[418 rows x 3 columns]
Overlap SNPs 418
Total rows of query:  500 Total rows of subject:  500
Overlap chr:pos 500
              sign_flip  strand_flip  exact_match
1:18744859         True        False        False
1:19112524         True        False        False
1:19112744         True        False        False
1:19220870         True        False        False
1:19324561         True        False        False
...                 ...          ...          ...
10:91959301        True        False        False
10:93074445        True        False        False
10:94171346        True        False        False
10:100293231       True        False        False
10:101803994       True        False        False

[418 rows x 3 columns]
Overlap SNPs 418
Total rows of query:  500 Total rows of subject:  500
Overlap chr:pos 500
              sign_flip  strand_flip  exact_match
1:18744859        False        False         True
1:19112524        False        False         True
1:19112744        False        False         True
1:19220870        False        False         True
1:19324561        False        False         True
...                 ...          ...          ...
10:91959301       False        False         True
10:93074445       False        False         True
10:94171346       False        False         True
10:100293231      False        False         True
10:101803994      False        False         True

[418 rows x 3 columns]
Overlap SNPs 418
Total rows of query:  1000 Total rows of subject:  500
Overlap chr:pos 500
              sign_flip  strand_flip  exact_match
1:18744859        False        False         True
1:19112524        False        False         True
1:19112744        False        False         True
1:19220870        False        False         True
1:19324561        False        False         True
...                 ...          ...          ...
10:91959301       False        False         True
10:93074445       False        False         True
10:94171346       False        False         True
10:100293231      False        False         True
10:101803994      False        False         True

[418 rows x 3 columns]
Overlap SNPs 418
Total number of common SNPs:  418
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/tmp/1988675.1.plot.q/ipykernel_5955/2259156742.py:25: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  new_query.STAT[pm.sign_flip] = -new_query.STAT[pm.sign_flip]
/tmp/1988675.1.plot.q/ipykernel_5955/2259156742.py:25: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  new_query.STAT[pm.sign_flip] = -new_query.STAT[pm.sign_flip]
/tmp/1988675.1.plot.q/ipykernel_5955/2259156742.py:25: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  new_query.STAT[pm.sign_flip] = -new_query.STAT[pm.sign_flip]
/tmp/1988675.1.plot.q/ipykernel_5955/2259156742.py:25: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  new_query.STAT[pm.sign_flip] = -new_query.STAT[pm.sign_flip]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>All are done!!!
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">yml</span> <span class="o">=</span> <span class="n">load_yaml</span><span class="p">(</span><span class="s1">&#39;../xqtl-pipeline/pipeline/misc/data/template.yml&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_dict</span> <span class="o">=</span> <span class="n">parse_input</span><span class="p">(</span><span class="n">yml</span><span class="p">[</span><span class="s1">&#39;INPUT&#39;</span><span class="p">])</span>
<span class="n">target_dict</span> <span class="o">=</span> <span class="n">parse_input</span><span class="p">(</span><span class="n">yml</span><span class="p">[</span><span class="s1">&#39;TARGET&#39;</span><span class="p">])</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="n">yml</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">yml</span><span class="p">[</span><span class="s1">&#39;TARGET&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[{&#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps500.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;,
   &#39;CHR&#39;: &#39;CHR&#39;,
   &#39;POS&#39;: &#39;POS&#39;,
   &#39;A0&#39;: &#39;REF&#39;,
   &#39;A1&#39;: &#39;ALT&#39;,
   &#39;SNP&#39;: &#39;SNP&#39;,
   &#39;STAT&#39;: &#39;BETA&#39;,
   &#39;SE&#39;: &#39;SE&#39;,
   &#39;P&#39;: &#39;P&#39;}}]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_dict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps500_flip_rea0a1.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;,
  &#39;CHR&#39;: &#39;CHR&#39;,
  &#39;POS&#39;: &#39;POS&#39;,
  &#39;A0&#39;: &#39;REF&#39;,
  &#39;A1&#39;: &#39;ALT&#39;,
  &#39;SNP&#39;: &#39;SNP&#39;,
  &#39;STAT&#39;: &#39;BETA&#39;,
  &#39;SE&#39;: &#39;SE&#39;,
  &#39;P&#39;: &#39;P&#39;},
 &#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps500_rea0a1.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;,
  &#39;CHR&#39;: &#39;CHR&#39;,
  &#39;POS&#39;: &#39;POS&#39;,
  &#39;A0&#39;: &#39;REF&#39;,
  &#39;A1&#39;: &#39;ALT&#39;,
  &#39;SNP&#39;: &#39;SNP&#39;,
  &#39;STAT&#39;: &#39;BETA&#39;,
  &#39;SE&#39;: &#39;SE&#39;,
  &#39;P&#39;: &#39;P&#39;},
 &#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps500.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;,
  &#39;CHR&#39;: &#39;CHR&#39;,
  &#39;POS&#39;: &#39;POS&#39;,
  &#39;A0&#39;: &#39;REF&#39;,
  &#39;A1&#39;: &#39;ALT&#39;,
  &#39;SNP&#39;: &#39;SNP&#39;,
  &#39;STAT&#39;: &#39;BETA&#39;,
  &#39;SE&#39;: &#39;SE&#39;,
  &#39;P&#39;: &#39;P&#39;},
 &#39;../xqtl-pipeline/pipeline/misc/data/testflip/snps1000.regenie.snp_stats.gz&#39;: {&#39;ID&#39;: &#39;CHR,POS&#39;,
  &#39;CHR&#39;: &#39;CHR&#39;,
  &#39;POS&#39;: &#39;POS&#39;,
  &#39;A0&#39;: &#39;REF&#39;,
  &#39;A1&#39;: &#39;ALT&#39;,
  &#39;SNP&#39;: &#39;SNP&#39;,
  &#39;STAT&#39;: &#39;BETA&#39;,
  &#39;SE&#39;: &#39;SE&#39;,
  &#39;P&#39;: &#39;P&#39;},
 &#39;../xqtl-pipeline/pipeline/misc/data/testflip/flip/snps500_flip.regenie.snp_stats.gz&#39;: None}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">target_dict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">target_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">merge_sumstats</span><span class="p">(</span><span class="n">yml</span><span class="p">,</span><span class="n">keep_ambiguous</span><span class="p">):</span>
    <span class="c1">#parse yaml</span>
    <span class="n">yml</span> <span class="o">=</span> <span class="n">load_yaml</span><span class="p">(</span><span class="n">yml</span><span class="p">)</span>
    <span class="n">input_dict</span> <span class="o">=</span> <span class="n">parse_input</span><span class="p">(</span><span class="n">yml</span><span class="p">[</span><span class="s1">&#39;INPUT&#39;</span><span class="p">])</span>
    <span class="n">target_dict</span> <span class="o">=</span> <span class="n">parse_input</span><span class="p">(</span><span class="n">yml</span><span class="p">[</span><span class="s1">&#39;TARGET&#39;</span><span class="p">])</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="n">yml</span><span class="p">[</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">]</span>

    <span class="n">input_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">target_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">target_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lst_sumstats_file</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of sumstats: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_sumstats_file</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst_sumstats_file</span><span class="p">))</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_sumstats_file</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;There are duplicated names in &quot;</span><span class="p">,</span> <span class="n">lst_sumstats_file</span><span class="p">)</span>
    <span class="c1">#read all sumstats</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>
    <span class="n">lst_sumstats</span> <span class="o">=</span> <span class="p">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">read_sumstat</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">nqs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">lst_sumstats</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">nq</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">snps_match</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">lst_sumstats</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">target_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])],</span><span class="n">keep_ambiguous</span><span class="p">)</span>
        <span class="n">nqs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nq</span><span class="p">)</span>
    <span class="c1">#get common snps</span>
    <span class="n">common_snps</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">nq</span><span class="o">.</span><span class="n">SNP</span><span class="p">)</span> <span class="k">for</span> <span class="n">nq</span> <span class="ow">in</span> <span class="n">nqs</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total number of common SNPs: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">common_snps</span><span class="p">))</span>
    <span class="c1">#write out new smustats</span>
    <span class="k">for</span> <span class="n">output_sumstats</span><span class="p">,</span><span class="n">nq</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lst_sumstats_file</span><span class="p">,</span><span class="n">nqs</span><span class="p">):</span>
        <span class="n">sumstats</span> <span class="o">=</span> <span class="n">nq</span><span class="p">[</span><span class="n">nq</span><span class="o">.</span><span class="n">SNP</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">common_snps</span><span class="p">)]</span>
        <span class="n">sumstats</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">output_sumstats</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span><span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All are done!!!&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">load_yaml</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">yaml_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">yml</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yml</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">parse_input</span><span class="p">(</span><span class="n">yml_input</span><span class="p">):</span>
    <span class="n">input_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">yml_input</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">input_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">input_dict</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a_dict</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;B&#39;: 2, &#39;C&#39;: 3}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s1">&#39;a,b&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;a&#39;, &#39;b&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">read_sumstat</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">config</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sumstats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;gzip&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">sumstats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sumstats</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">sumstats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">config</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sumstats</span> <span class="o">=</span> <span class="n">sumstats</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;According to config_file, input summary statistics should have the following columns: %s&#39;</span> <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">sumstats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">sumstats</span><span class="o">.</span><span class="n">SNP</span> <span class="o">=</span> <span class="s1">&#39;chr&#39;</span><span class="o">+</span><span class="n">sumstats</span><span class="o">.</span><span class="n">CHR</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">sumstats</span><span class="o">.</span><span class="n">POS</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">sumstats</span><span class="o">.</span><span class="n">A0</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="n">sumstats</span><span class="o">.</span><span class="n">A1</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">sumstats</span><span class="o">.</span><span class="n">CHR</span> <span class="o">=</span> <span class="n">sumstats</span><span class="o">.</span><span class="n">CHR</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">sumstats</span><span class="o">.</span><span class="n">POS</span> <span class="o">=</span> <span class="n">sumstats</span><span class="o">.</span><span class="n">POS</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sumstats</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">snps_match</span><span class="p">(</span><span class="n">query</span><span class="p">,</span><span class="n">subject</span><span class="p">,</span><span class="n">keep_ambiguous</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">query</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">subject</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#overlap snps by chr+pos</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total rows of query: &quot;</span><span class="p">,</span><span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s2">&quot;Total rows of subject: &quot;</span><span class="p">,</span><span class="n">subject</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">subject</span><span class="p">[</span><span class="n">subject</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">subject</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overlap chr:pos&quot;</span><span class="p">,</span><span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">query</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;There are duplicated chr:pos&quot;</span><span class="p">)</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="n">pair_match</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span><span class="n">query</span><span class="o">.</span><span class="n">A0</span><span class="p">,</span><span class="n">subject</span><span class="o">.</span><span class="n">A1</span><span class="p">,</span><span class="n">subject</span><span class="o">.</span><span class="n">A0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">keep_ambiguous</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: there are&#39;</span><span class="p">,</span><span class="nb">sum</span><span class="p">(</span><span class="o">~</span><span class="n">pm</span><span class="o">.</span><span class="n">ambiguous</span><span class="p">),</span><span class="s1">&#39;ambiguous SNPs&#39;</span><span class="p">)</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="n">pm</span><span class="p">[</span><span class="o">~</span><span class="n">pm</span><span class="o">.</span><span class="n">ambiguous</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
    <span class="n">keep_idx</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">keep_idx</span> <span class="o">=</span> <span class="n">keep_idx</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">keep_idx</span><span class="o">==</span><span class="kc">True</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overlap SNPs&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">keep_idx</span><span class="p">))</span>
    <span class="c1">#overlap snps by chr+pos+alleles.</span>
    <span class="n">new_subject</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep_idx</span><span class="p">]</span>
    <span class="c1">#update beta and snp info</span>
    <span class="n">new_query</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">new_subject</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">5</span><span class="p">],</span><span class="n">query</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep_idx</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">5</span><span class="p">:]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">new_query</span><span class="o">.</span><span class="n">STAT</span><span class="p">[</span><span class="n">pm</span><span class="o">.</span><span class="n">sign_flip</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">new_query</span><span class="o">.</span><span class="n">STAT</span><span class="p">[</span><span class="n">pm</span><span class="o">.</span><span class="n">sign_flip</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">new_query</span><span class="p">,</span><span class="n">new_subject</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pair_match</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">ref1</span><span class="p">,</span><span class="n">ref2</span><span class="p">):</span>
    <span class="c1"># a1 and a2 are the first data-set</span>
	<span class="c1"># ref1 and ref2 are the 2nd data-set</span>
	<span class="c1"># Make all the alleles into upper-case, as A,T,C,G:</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">a1</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">a2</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">ref1</span> <span class="o">=</span> <span class="n">ref1</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">ref2</span> <span class="o">=</span> <span class="n">ref2</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
	<span class="c1"># Strand flip, to change the allele representation in the 2nd data-set</span>
    <span class="n">flip1</span> <span class="o">=</span> <span class="n">ref1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">strand_flip</span><span class="p">)</span>
    <span class="n">flip2</span> <span class="o">=</span> <span class="n">ref2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">strand_flip</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;ambiguous&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="s2">&quot;T&quot;</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="s2">&quot;T&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="s2">&quot;A&quot;</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="s2">&quot;G&quot;</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="s2">&quot;G&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
    <span class="c1"># as long as scenario 1 is involved, sign_flip will return TRUE</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;sign_flip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="n">ref2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="n">ref1</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="n">flip2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="n">flip1</span><span class="p">))</span>
	<span class="c1"># as long as scenario 2 is involved, strand_flip will return TRUE</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;strand_flip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="n">flip1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="n">flip2</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">a1</span><span class="o">==</span><span class="n">flip2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span><span class="o">==</span><span class="n">flip1</span><span class="p">))</span>
	<span class="c1"># remove other cases, eg, tri-allelic, one dataset is A C, the other is A G, for example.</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;exact_match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">a1</span> <span class="o">==</span> <span class="n">ref1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a2</span> <span class="o">==</span> <span class="n">ref2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">strand_flip</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Seq</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

