Metadata-Version: 2.1
Name: expose-localhost
Version: 0.4.2
Summary: Expose an app/api running on local host to public internet using AWS EC2
Home-page: https://github.com/thevickypedia/expose
Author: Vignesh Sivanandha Rao
Author-email: svignesh1793@gmail.com
License: UNKNOWN
Keywords: route53,certificate,ec2,ngrok-alternative,tunnel
Platform: UNKNOWN
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Information Technology
Classifier: Operating System :: OS Independent
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3.9
Classifier: Topic :: System :: Networking :: Firewalls
Description-Content-Type: text/markdown; charset=UTF-8
License-File: LICENSE
Requires-Dist: boto3 (>=1.20.24)
Requires-Dist: botocore (>=1.23.24)
Requires-Dist: urllib3 (>=1.26.7)
Requires-Dist: python-dotenv (>=0.19.2)
Requires-Dist: paramiko (>=2.8.1)
Requires-Dist: click (>=8.0.3)
Requires-Dist: psutil (>=5.8.0)
Requires-Dist: requests (>=2.26.0)
Requires-Dist: pyOpenSSL (>=21.0.0)
Requires-Dist: scp (>=0.14.2)
Requires-Dist: setuptools (>=58.1.0)

# Expose localhost using EC2
Expose an app/api running on local host to public internet using AWS EC2

### Requirements
- Access to an AWS account.
- A `service/app/api` running on a specific port that has to be exposed to public internet.
- **[Optional]** A domain `example.com` hosted on `route53`.

### Setup
#### Environment Variables:
Environment variables can optionally be placed in a `.env` file as [`expose`](https://github.com/thevickypedia/expose)
loads `.env` files during start up.

**Mandatory Arg:**
- `PORT`: Port number on which a localhost `service/app/api` is running.

**Optional Args:**
- `AMI_ID`: ID of any public AMI with an Ubuntu OS. Defaults to a region specific image ID.
- `ACCESS_KEY`: Access key to access AWS resources. Defaults to `~/.aws/config`
- `SECRET_KEY`: Secret key to access AWS resources. Defaults to `~/.aws/config`
- `REGION_NAME`: Region name where the instance should live. Defaults to `US-WEST-2`
- `DOMAIN`: If the domain name is registered using `route53`. *Example: `mywebsite.com`*
- `SUBDOMAIN`: Sub-domain that has to be added for the domain name. *Example: `tunnel.mywebsite.com`*
- `EMAIL`: Email address to create the self-signed SSL and private key. Defaults to `USER@expose-localhost.com`
- `ORG`: Organization name for the certificate. Defaults to the AWS endpoint.

<details>
<summary><strong>Setup a custom endpoint</strong></summary>

The public DNS names for EC2 instances are long and messy. To avoid that, an `A` record can be added to the `route53` hosted zone.

:warning: &nbsp; Requires an active hosted zone on `route53`.

- `DOMAIN`: If the domain name is registered using `route53`. *Example: `mywebsite.com`*
- `SUBDOMAIN`: Sub-domain that has to be added for the domain name. *Example: `tunnel.mywebsite.com`*

&nbsp; &nbsp; &nbsp; &nbsp; :bulb: &nbsp; This will be the endpoint to access the localhost.

</details>

#### Certificate:
- Securing the tunnel requires the certificate chain and the key file.
- These two files should be saved as `cert.pem` and `key.pem` in either `~.ssh/*.pem` or within `expose` repository.
- No certs? No problem. [`expose`](https://github.com/thevickypedia/expose/blob/main/expose/helpers/cert.py) will 
generate a self-signed certificate and a private key automatically.

<details>
<summary><strong>Generate private SSL certificate</strong></summary>

Unfortunately not many SSL certificate providers give the liberty to download key files. But `expose`, can use private certificates.

:warning: &nbsp; Some web browsers might throw a warning and some might even block a self-signed certificate/private CA.

To manually generate a self-signed cert:

> `openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout ~/.ssh/key.pem -out ~/.ssh/cert.pem`

[OR]

Simply let `expose` create a self-signed SSL certificate and a private key.

- `EMAIL`: Email address to create the self-signed SSL and private key. Defaults to `USER@expose-localhost.com`
- `ORG`: Organization name for the certificate. Defaults to the AWS endpoint.

</details>

#### Installation
[`python3 -m pip install --upgrade expose-localhost`](https://pypi.org/project/expose-localhost/)

###### Start tunneling:
```python
from expose.tunnel import Tunnel

Tunnel().start()
```

###### Stop tunneling:
```python
from expose.tunnel import Tunnel

Tunnel().stop()
```

###### Class Instantiation

This is required _only_ if a `.env` file missing and the env vars are not configured, or if the user needs to bypass
default values.

```python
from expose.tunnel import Tunnel

Tunnel(port=2021, image_id='ami-06e20d17437157772',
       domain_name='example.com', subdomain='expose',
       aws_access_key='A1YSAIEPAJK1830AB1N',
       aws_secret_key='e38409/afjeafjllvi19io90eskqn',
       aws_region_name='us-east-2',
       email_address='root@expose-localhost.com',
       organization='Expose Localhost')
```

<details>
<summary><strong>Troubleshooting</strong></summary>

> If `E: Could not get lock /var/lib/dpkg/lock-frontend` occurs during startup, simply rerun the script with start command.
> This occurs when `apt` hasn't released the resources yet. Re-running the script with the arg `start` will simply re-configure the instance.

</details>

#### Linting
`PreCommit` will ensure linting, and the doc creation are run on every commit.

#### Requirement
`pip install --no-cache --upgrade sphinx pre-commit recommonmark`

#### Usage
`pre-commit run --all-files`

### Pypi Package
[![pypi-module](https://img.shields.io/badge/Software%20Repository-pypi-1f425f.svg)](https://packaging.python.org/tutorials/packaging-projects/)

[https://pypi.org/project/expose-localhost/](https://pypi.org/project/expose-localhost/)

### Runbook
[![made-with-sphinx-doc](https://img.shields.io/badge/Code%20Docs-Sphinx-1f425f.svg)](https://www.sphinx-doc.org/en/master/man/sphinx-autogen.html)

[https://thevickypedia.github.io/expose/](https://thevickypedia.github.io/expose/)

## License & copyright

&copy; Vignesh Sivanandha Rao

Licensed under the [MIT License](https://github.com/thevickypedia/expose/blob/main/LICENSE)


Change Log
==========

0.4.2 (05/01/2022)
------------------
- Fix imports and remove redundancy
- Remove unused functions

0.4.1 (01/19/2022)
------------------
- Check for app running on port before initiating tunneling
- Flush screen output before carriage return
- Take optional args to terminate instance and delete security group
- Remove unnecessary args

0.4.0 (01/15/2022)
------------------
- Update python-publish.yml

0.3.9 (01/15/2022)
------------------
- Write file to server directly from github
- Avoid saving config files locally
- Fix logging

0.3.8 (01/15/2022)
------------------
- Remove print statements and create a default log formatter

0.3.7 (01/15/2022)
------------------
- Use sockets and channels for reverse ssh port forwarding
- Check for files after running SCP
- Convert port to integer using exception handler

0.3.6 (01/13/2022)
------------------
- Reduce `os.system` usage
- Add an exception handler for subprocess
- Remove unnecessary vars

0.3.5 (01/09/2022)
------------------
- Update module as stable

0.3.4 (01/06/2022)
------------------
- Fix intermittent IP info missing issue

0.3.3 (01/05/2022)
------------------
- Add an option for length of RSA signature
- Remove incorrect return statement

0.3.2 (01/05/2022)
------------------
- Remove `AMI_ID` from mandatory args
- Retrieve AMI_ID automatically
- Setup AWS defaults

0.3.1 (01/05/2022)
------------------
- Check `env vars`/`args` before startup
- Add default image id if region is us-west-2

0.3.0 (01/04/2022)
------------------
- Take `ORG` and `EMAIL` as both args and env vars

0.2.9 (01/04/2022)
------------------
- Update docs and make isort happy

0.2.8 (01/04/2022)
------------------
- Move `prefix` function to auxiliary.py
- Re-arrange args
- Update README.md and requirements.txt

0.2.7 (01/04/2022)
------------------
- Create SSL certificate by default
- Use paramiko to perform server copy
- Make application compatible as a perfect module

0.2.6 (01/04/2022)
------------------
- Download configuration files from git during run time
- Take all env vars as optional arguments during class initialization

0.2.5 (01/04/2022)
------------------
- Move configuration files into a dedicated directory

0.2.4 (01/03/2022)
------------------
- Fix `requirements.txt` path in `setup.py`

0.2.3 (01/03/2022)
------------------
- Update python-publish.yml

0.2.2 (01/03/2022)
------------------
- Try using `package_data` to include helpers directory

0.2.1 (01/03/2022)
------------------
- Remove find_packages

0.2.0 (01/03/2022)
------------------
- Try using find_packages to include helpers directory
- Update module name for docs

0.1.9 (01/03/2022)
------------------
- Add MANIFEST.in to include helpers directory
- Rename tunnel.py to expose.py

0.1.8 (01/03/2022)
------------------
- Bump version

0.1.7 (01/03/2022)
------------------
- Setup pypi publish

0.1.6 (01/03/2022)
------------------
- Create python-publish.yml

0.1.5 (01/03/2022)
------------------
- Change wait times and typos

0.1.4 (12/23/2021)
------------------
- Get name of the calling file gracefully
- Log the action in route_53.py
- Update README.md

0.1.3 (12/20/2021)
------------------
- Update README.md
- Get rid of hard coded / for path

0.1.2 (12/20/2021)
------------------
- Make expose as a CLI tool

0.1.1 (12/20/2021)
------------------
- Add lost changes on nginx_server.py

0.1.0 (12/20/2021)
------------------
- Add sphinx auto-gen docs
- Fix docstrings and module names

0.0.9 (12/20/2021)
------------------
- Format print statements in config to logger type
- Change some function names

0.0.8 (12/20/2021)
------------------
- Use `paramiko` for interactive ssh setup

0.0.7 (12/20/2021)
------------------
- Add boto3 error handling

0.0.6 (12/19/2021)
------------------
- Enable `https` for the endpoints
- Requires .pem files in .ssh or cwd

0.0.5 (12/19/2021)
------------------
- Add config files for SSL to enable https on the endpoint serving the app/api

0.0.4 (12/18/2021)
------------------
- Setup automatic configuration
- Delete Route53 record when tunneling is to be closed
- Onboard nginx.conf and server.conf

0.0.3 (12/18/2021)
------------------
- Onboard a script to add DNS records to a hosted zone
- Modify logger formatting

0.0.2 (12/18/2021)
------------------
- Replicate EC2 creation part from vpn-server
- Update .gitignore, LICENSE and README.md
- Add requirements.txt and expose.py

0.0.1 (12/18/2021)
------------------
- Initial commit


