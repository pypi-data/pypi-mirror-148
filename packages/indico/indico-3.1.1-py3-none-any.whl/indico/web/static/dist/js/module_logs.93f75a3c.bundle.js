"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2089],{39238:(e,t,r)=>{var n=r(32735),s=r(12788),a=r(31448),i=r(70242),l=r(33348),c=r.n(l),o=r(59090);const u="SET_KEYWORD",m="SET_FILTER",p="SET_PAGE",d="UPDATE_ENTRIES",g="FETCH_STARTED",h="FETCH_FAILED",E="SET_DETAILED_VIEW",y="SET_METADATA_QUERY",f="SET_INITIAL_REALMS";function w(e){return{type:p,currentPage:e}}function b(e){return{type:E,currentViewIndex:e}}function v(e){return{type:y,metadataQuery:e}}function N(){return async(e,t)=>{e({type:g});const{logs:{filters:r,keyword:n,currentPage:s,metadataQuery:a},staticData:{fetchLogsUrl:i}}=t(),l={page:s,filters:[],meta:a};let u;n&&(l.q=n),Object.entries(r).forEach((e=>{let[t,r]=e;r&&l.filters.push(t)}));try{u=await o.l2.get(i,{params:l,paramsSerializer:e=>c().stringify(e,{arrayFormat:"repeat",allowDots:!0})})}catch(t){return(0,o.zZ)(t),void e({type:h})}const{entries:m,pages:p,total_page_count:E}=u.data;e(function(e,t,r){return{type:d,entries:e,pages:t,totalPageCount:r}}(m,p,E))}}var P=r(19306),x=r(47169),D=r(53806),R=r.n(D),C=r(60216),k=r.n(C),O=r(69184),T=r(44409),V=r(17410);class I extends n.Component{constructor(e){super(e),this.modal=void 0,this.onClose=this.onClose.bind(this),this.prevEntry=this.prevEntry.bind(this),this.nextEntry=this.nextEntry.bind(this),this.relatedEntries=this.relatedEntries.bind(this)}componentDidUpdate(){const{currentViewIndex:e}=this.props;null!==e&&this.open()}open(){this.modal.open()}onClose(){const{setDetailedView:e}=this.props;e(null)}prevEntry(){const{prevEntry:e}=this.props;e()}nextEntry(){const{nextEntry:e}=this.props;e()}relatedEntries(){const{relatedEntries:e}=this.props;e()}_isFirstEntry(){const{currentPage:e,currentViewIndex:t}=this.props;return 1===e&&0===t}_isLastEntry(){const{currentPage:e,totalPageCount:t,currentViewIndex:r,entries:n}=this.props;return e===t&&r===n.length-1}_hasRelatedEntries(){const{currentViewIndex:e,entries:t}=this.props,r=t[e];return 0!==Object.keys(r.meta).length}render(){const{currentViewIndex:e,entries:t}=this.props;if(null===e)return"";const{description:r,html:s,user:{fullName:a},time:i}=t[e];return n.createElement(T.u_,{title:r,ref:e=>{this.modal=e},onClose:this.onClose,contentLabel:"Details about log entry",fixedFooter:!0},n.createElement(V.g7,null,n.createElement("table",{className:"i-table log-modal-details",dangerouslySetInnerHTML:{__html:s}}),n.createElement("div",{className:"text-superfluous log-modal-author-info flexrow f-j-end"},n.createElement("span",null,a&&n.createElement("span",{className:"log-modal-user"},a," "),"on",n.createElement("span",{className:"log-modal-time"}," ",R()(i).format("ddd, D/M/YYYY HH:mm"))))),n.createElement(V.g7,{name:"footer"},n.createElement("div",{className:"group flexrow f-j-space-between"},n.createElement(T.Lp,{title:"Previous",icon:"prev",onClick:this.prevEntry,disabled:this._isFirstEntry()},n.createElement(P.vN,null,"Previous")),n.createElement(T.Lp,{onClick:this.relatedEntries,disabled:!this._hasRelatedEntries()},n.createElement(P.vN,null,"Related entries")),n.createElement(T.Lp,{title:"Next",classes:{next:!0},highlight:!0,onClick:this.nextEntry,disabled:this._isLastEntry()},n.createElement(P.vN,null,"Next")))))}}(0,x.Z)(I,"propTypes",{entries:k().array.isRequired,currentViewIndex:k().number,setDetailedView:k().func.isRequired,prevEntry:k().func.isRequired,nextEntry:k().func.isRequired,relatedEntries:k().func.isRequired,currentPage:k().number.isRequired,totalPageCount:k().number.isRequired}),(0,x.Z)(I,"defaultProps",{currentViewIndex:null});const S=(0,a.connect)((e=>{let{logs:t}=e;return{currentViewIndex:t.currentViewIndex,currentPage:t.currentPage,totalPageCount:t.totalPageCount}}),(e=>({setDetailedView:t=>{e(b(t))},prevEntry:()=>{e((async(e,t)=>{const{staticData:{pageSize:r},logs:{currentViewIndex:n,currentPage:s}}=t();0===n?0===s||(await e(w(s-1)),await e(N()),await e(b(r-1))):e({type:E,currentViewIndex:n-1})}))},nextEntry:()=>{e((async(e,t)=>{const{staticData:{pageSize:r},logs:{currentViewIndex:n,currentPage:s,pages:a}}=t();n===r-1?s===a[a.length-1]||(await e(w(s+1)),await e(b(0)),await e(N())):e({type:E,currentViewIndex:n+1})}))},relatedEntries:()=>{e(((e,t)=>{const{logs:{entries:r,currentViewIndex:n}}=t(),s=r[n],a=c().stringify({meta:s.meta},{allowDots:!0});e(v(s.meta)),e(w(1)),e(b(null)),e(N()),history.replaceState({},null,`${location.pathname}?${a}`)}))}})))(I);class q extends n.PureComponent{constructor(e){super(e),this.openDetails=this.openDetails.bind(this)}openDetails(e){const{setDetailedView:t}=this.props;t(e)}iconProps(e){if("email"===e.type)switch(e.payload.state){case"pending":return{className:"log-icon semantic-text warning",title:P.vN.string("This email is pending and will be sent soon."),"data-qtip-style":"warning"};case"sent":return{className:"log-icon semantic-text success",title:P.vN.string("This email has been sent."),"data-qtip-style":"success"};case"failed":return{className:"log-icon semantic-text error",title:P.vN.string("Sending this email failed."),"data-qtip-style":"danger"}}return{className:"log-icon"}}entryKind(e){if("email"!==e.type)return e.kind;return{pending:"change",sent:"positive",failed:"negative"}[e.payload.state]||"other"}render(){const{entry:e}=this.props;return n.createElement("li",{className:`log-realm-${e.realm} log-kind-${this.entryKind(e)}`},n.createElement("span",{className:"log-module"},n.createElement("span",this.iconProps(e),n.createElement("i",{className:"log-realm"}),n.createElement("i",{className:"log-kind icon-circle-small"})),n.createElement("span",{className:"bold"},e.module)),n.createElement(T.Tm,null,n.createElement("span",{className:"log-entry-description",onClick:()=>this.openDetails(e.index)},e.description)),n.createElement("span",{className:"log-entry-details"},n.createElement("span",{className:"logged-time",title:R()(e.time).format("DD/MM/YYYY HH:mm")},n.createElement("time",{dateTime:e.time},R()(e.time).fromNow())),e.user.avatarURL?n.createElement(O.Z,{avatar:!0,title:e.user.fullName,src:e.user.avatarURL,className:"user-picture ui-qtip"}):""))}}(0,x.Z)(q,"propTypes",{entry:k().object.isRequired,setDetailedView:k().func.isRequired});class F extends n.PureComponent{renderEmpty(){return n.createElement(T._p,{type:"info"},"No logs to show")}renderSpinner(){return n.createElement("div",{className:"event-log-list-spinner"},n.createElement("div",{className:"i-spinner"}))}renderList(){const{entries:e,pages:t,currentPage:r,changePage:s,isFetching:a,setDetailedView:i}=this.props;return n.createElement(n.Fragment,null,a&&this.renderSpinner(),n.createElement("ul",{className:"event-log-list "+(a?"loading":"")},e.map((e=>n.createElement(q,{key:e.id,entry:e,setDetailedView:i})))),!a&&n.createElement(T.Ds,{currentPage:r,pages:t,changePage:s}),n.createElement(S,{entries:e}))}render(){const{entries:e,isFetching:t}=this.props;return 0===e.length?t?this.renderSpinner():this.renderEmpty():this.renderList()}}(0,x.Z)(F,"propTypes",{entries:k().array.isRequired,currentPage:k().number.isRequired,pages:k().array.isRequired,changePage:k().func.isRequired,isFetching:k().bool.isRequired,setDetailedView:k().func.isRequired});const _=(0,a.connect)((e=>{let{logs:t}=e;return{entries:t.entries,currentPage:t.currentPage,pages:t.pages,isFetching:t.isFetching}}),(e=>({changePage:t=>{e(w(t)),e(N())},setDetailedView:t=>{e(b(t))}})))(F);class j extends n.Component{render(){const{realms:e,filters:t,setFilter:r}=this.props;return n.createElement("div",{className:"toolbar"},n.createElement("div",{className:"group i-selection "+(e.length<=1?"hidden":"")},n.createElement("span",{className:"i-button label"},n.createElement(P.vN,null,"Show")),Object.keys(e).sort().map((s=>n.createElement(n.Fragment,{key:s},n.createElement("input",{type:"checkbox",id:`realm-${s}`,"data-realm":s,defaultChecked:t[s],onChange:e=>r({[s]:e.target.checked})}),n.createElement("label",{htmlFor:`realm-${s}`,className:"i-button"},e[s]))))))}}(0,x.Z)(j,"propTypes",{realms:k().object.isRequired,filters:k().object.isRequired,setFilter:k().func.isRequired});const L=(0,a.connect)((e=>{let{logs:t}=e;return{filters:t.filters}}),(e=>({setFilter:t=>{e(function(e){return{type:m,filter:e}}(t)),e(w(1)),e(N())}})))(j);var Z=r(45750),A=r.n(Z);class Y extends n.Component{render(){const{setKeyword:e}=this.props;return n.createElement("div",{className:"toolbar"},n.createElement("div",{className:"group"},n.createElement("span",{className:"i-button label"},n.createElement("span",{className:"icon-search"})),n.createElement("input",{type:"text",onChange:t=>e(t.target.value.trim())})))}}(0,x.Z)(Y,"propTypes",{setKeyword:k().func.isRequired});const U=(0,a.connect)(null,(e=>({setKeyword:A()((t=>{e(function(e){return{type:u,keyword:e}}(t)),e(w(1)),e(N())}),250)})))(Y);class Q extends n.Component{render(){const{realms:e}=this.props;return n.createElement("div",{className:"toolbars"},n.createElement(L,{realms:e}),n.createElement(U,null))}}(0,x.Z)(Q,"propTypes",{realms:k().object.isRequired});const H=(0,a.connect)((e=>{let{staticData:t}=e;return{realms:t.realms}}))(Q);function K(){const e=(0,a.useDispatch)();return n.createElement("div",{className:"highlight-message-box"},n.createElement("span",{className:"icon"}),n.createElement("div",{className:"message-text"},n.createElement(P.vN,null,"Log entries are currently filtered by URL."," ",n.createElement(P.dO,{name:"link",wrapper:n.createElement("a",{onClick:()=>{e((e=>{e(v({})),e(w(1)),e(b(null)),e(N()),history.replaceState({},null,location.pathname)}))}})},"Click here")," ","to disable the filter.")))}function M(){const e=(0,a.useSelector)((e=>e.logs.metadataQuery));return n.createElement(n.Fragment,null,0!==Object.keys(e).length&&n.createElement(K,null),n.createElement(H,null),n.createElement(_,null))}function $(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}K.propTypes={};const J={entries:[],keyword:null,currentPage:1,isFetching:!1,metadataQuery:{},filters:{},pages:[],totalPageCount:0,currentViewIndex:null};function W(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return z(z({},e),{},{filters:Object.fromEntries(t.initialRealms.map((e=>[e,!0])))});case u:return z(z({},e),{},{keyword:t.keyword});case m:return z(z({},e),{},{filters:z(z({},e.filters),t.filter)});case p:return z(z({},e),{},{currentPage:t.currentPage});case d:return z(z({},e),{},{entries:t.entries,pages:t.pages,totalPageCount:t.totalPageCount,isFetching:!1});case g:return z(z({},e),{},{isFetching:!0});case h:return z(z({},e),{},{isFetching:!1});case E:return z(z({},e),{},{currentViewIndex:t.currentViewIndex});case y:return z(z({},e),{},{metadataQuery:t.metadataQuery});default:return e}}window.addEventListener("load",(()=>{const e=document.querySelector(".event-log"),t={staticData:{fetchLogsUrl:e.dataset.fetchLogsUrl,realms:JSON.parse(e.dataset.realms),pageSize:15}},r=(0,i.ZP)("event-logs",{logs:W},t);var l;r.dispatch((l=Object.keys(t.staticData.realms),{type:f,initialRealms:l})),r.dispatch(v(JSON.parse(e.dataset.metadataQuery))),s.render(n.createElement(a.Provider,{store:r},n.createElement(M,null)),e),r.dispatch(N())}))}},e=>{e.O(0,[5514,3044,8592],(()=>{return t=39238,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_logs.93f75a3c.bundle.js.map