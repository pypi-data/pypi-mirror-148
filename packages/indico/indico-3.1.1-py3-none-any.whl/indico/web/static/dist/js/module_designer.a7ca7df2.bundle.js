(self.webpackChunk=self.webpackChunk||[]).push([[1113],{33832:(t,e,i)=>{"use strict";var n=i(90567),a=i.n(n),o=i(98978),l=i.n(o),s=i(80340),c=i.n(s),d=i(69403),r=i.n(d),h=i(86330),g=i.n(h),u=i(61941),f=i.n(u),p=i(11986),m=i.n(p),b=i(28995);!function(t){var e,i,n,o,s,d=!1,h=-1,u=!1,p={},v={},k=null,x={},w=null,_=null,j=!1,y=b.$T.gettext("The back side of the templates that use this one as the back side will be removed."),C=b.$T.gettext("Disassociate back sides"),T=!1;let z=null;function I(t){return z.includes(t)}function M(t){return t*s}function D(t){return t/s}function O(t,e){return t(/([0-9.]+)pt/g.exec(e)[1])+"pt"}var q=m()(O,M),F=m()(O,M);function H(t){var e={id:++h,type:t,x:n,y:o,font_family:"sans-serif",bold:!1,italic:!1,text_align:"center",color:"#000000",background_color:null,font_size:"15pt",width:I(t)?150:400,height:I(t)?150:null,text:(0,b.$T)("Fixed text"),zIndex:h+10,selected:!1};return e.toHTML=function(){return $("<div>").addClass("designer-item").toggleClass("selected",this.selected).css({width:M(this.width),height:this.height?M(this.height):this.height,cursor:"move",fontWeight:this.bold?"bold":"normal",fontStyle:this.italic?"italic":"normal",fontFamily:this.font_family,fontSize:q(this.font_size),textAlign:this.text_align.replace("Justified","justify"),color:this.color,backgroundColor:this.background_color,zIndex:this.zIndex}).attr("data-type",this.type).text("fixed"===this.type?this.text:x[this.type])}.bind(e),e}function W(t,e){this.realWidth=t,this.realHeight=e,this.width=M(t),this.height=M(e)}function P(t,e){var i=e?".template-side.back":".template-side.front",n=$("<div/>").css({position:"absolute",left:t.x+"px",top:t.y+"px",zIndex:t.zIndex}).data("id",t.id).attr("data-id",t.id).appendTo(i);return e||n.draggable({containment:i,opacity:.5,drag:function(t,e){d&&(e.position.left=10*Math.floor(e.position.left/10),e.position.top=10*Math.floor(e.position.top/10))},stop:function(t,e){var i=$(this).data("id");p[i].x=D(e.position.left),p[i].y=D(e.position.top)}}),n}function E(t,e){if(t.length){var i=t.closest(".ui-draggable").data("id");return e?v[i]:p[i]}}function L(){return E($(".designer-item.selected"))}function A(t){var e=E(t);e&&(e.selected=!1,t.removeClass("selected"))}function S(t){var e=E(t);$(".element-tools").removeClass("hidden"),$(".second-row").removeClass("disappear"),$(".selection-text").html("fixed"===e.type?b.$T.gettext("Fixed text"):x[e.type]),A($(".designer-item.selected")),e.selected=!0,t.addClass("selected");var i=g()([e.bold?"bold":null,e.italic?"italic":null]);$("#text-color-selector").val(e.color);const a=$("#text-color-preview");a.toggleClass("no-value",!e.color),a.css({backgroundColor:e.color}),$("#bg-color-selector").val(e.background_color);const o=$("#bg-color-preview");o.toggleClass("no-value",!e.background_color),o.css({backgroundColor:e.background_color}),$("#alignment-selector").val(e.text_align),$("#font-selector").val(e.font_family),$("#size-selector").val(e.font_size),$("#style-selector").val(i.length?i.join("_"):"normal"),$(".js-element-width").val(e.width/n),$(".js-element-height").val(e.height/n);var l=$("#fixed-text-field");const s=$("#subtool-element-height");var c=$(".font-tools");"fixed"===e.type?(c.show(),l.closest(".tool").show(),l.val(e.text),s.hide()):I(e.type)?(c.hide(),l.closest(".tool").hide(),s.show()):(c.show(),l.closest(".tool").hide(),l.val(""),s.hide())}function U(){var t,a=Math.ceil(i.width/n),o=Math.ceil(e.width/n),l=Math.ceil(i.height/n),s=Math.ceil(e.height/n);if(e.width>i.width){var c=$("#horizontal-ruler");for(t=a;t<o;t++)$('<div class="marking"/>').attr("id","rulerh"+t).css({width:n+"px",left:t*n+"px",top:0}).html(t+1).appendTo(c)}else if(e.width<i.width)for(t=a;t>o;t--)$("#rulerh"+(t-1)).remove();if(e.height>i.height){var d=$("#vertical-ruler");for(t=l;t<s;t++)$('<div class="marking"/>').attr("id","rulerv"+t).css({"line-height":n/2+"px",height:n+"px",left:0,top:t*n+"px"}).html(t+1).appendTo(d)}else if(e.height<i.height)for(t=l;t>s;t--)$("#rulerv"+(t-1)).remove()}function J(t,a){var o=$(".template-container"),l=parseFloat($(".template-width").val()),s=parseFloat($(".template-height").val());o.width(Math.round(l*n)),o.height(Math.round(s*n)),i.width=e.width,i.height=e.height,e=new W(Math.round(50*l),Math.round(50*s)),U(),function(t,e){Q(t),e.background_url&&Q(e,!0)}(t,a),function(t,e){$(".js-preset-tool option").each((function(){var i=$(this);if("custom"!==i.val()){var n=i.data("width"),a=i.data("height");n===t&&a===e&&(i.prop("selected",!0),$(".js-template-dimension").prop("disabled",!0))}}))}(l,s)}function N(t,e){const{x:i,y:n}=t,{x:a,y:o}=e,l=i+t.width,s=n+(t.height||22),c=a+e.width,d=o+(e.height||22);return!(i>=c||a>=l)&&!(n>=d||o>=s)}function B(){l()(Object.values(p),"zIndex").forEach(((t,e)=>{t.zIndex=e+10,$(".ui-draggable[data-id="+t.id+"]").css("zIndex",e+10)}))}function G(t){var e=L(),i=$(".designer-item.selected");i&&({font:function(){e.font_family=$("#font-selector").val()},color:function(){e.color=$("#text-color-selector").val()},background_color:function(){e.background_color=$("#bg-color-selector").val()},alignment:function(){e.text_align=$("#alignment-selector").val()},size:function(){e.font_size=$("#size-selector").val()},style:function(){switch($("#style-selector").val()){case"normal":e.bold=!1,e.italic=!1;break;case"bold":e.bold=!0,e.italic=!1;break;case"italic":e.bold=!1,e.italic=!0;break;case"bold_italic":e.bold=!0,e.italic=!0}},text:function(){var t=$("#fixed-text-field");e.text=t.val().replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),t.val(e.text)},width:function(){e.width=Math.round($(".js-element-width").val()*n),"ticket_qr_code"===e.type&&($(".js-element-height").val($(".js-element-width").val()),e.height=e.width)},height:function(){e.height=Math.round($(".js-element-height").val()*n),"ticket_qr_code"===e.type&&($(".js-element-width").val($(".js-element-height").val()),e.width=e.height)}}[t](),i.replaceWith(e.toHTML()))}function K(t,i){if("stretch"===i)t.css({left:0,top:0}),t.height(e.height),t.width(e.width);else if("center"===i){var n,a=(o=t,(l=new Image).src=o.attr("src"),{width:l.width,height:l.height});t.height(a.height),t.width(a.width),t.width()>e.width||t.height()>e.height?(t.width()>e.width&&(n=e.width/t.width(),t.width(e.width),t.height(t.height()*n),t.css({left:0,top:e.height/2-t.height()/2+"px"})),t.height()>e.height&&(n=e.height/t.height(),t.width(t.width()*n),t.height(e.height),t.css({left:e.width/2-t.width()/2+"px",top:0}))):t.css({left:e.width/2-a.width/2+"px",top:e.height/2-a.height/2+"px"})}var o,l}function Q(t,i){var n=i?".template-side.back":".template-side.front",a=$(n).find(".background-image"),o=t.data.background_position;a.attr({src:t.background_url}).css({position:"absolute",left:0,top:0,height:e.height+"px",width:e.width+"px",zIndex:5}).on("load",(function(){$("#loadingIcon").hide(),K($(this),o)})).appendTo(n)}function R(t,e){t.data&&(t.data.items.forEach((function(t){!function(t,e){delete t.id;var i=f()(H(),t);e?v[i.id]=i:p[i.id]=i}(t,e)})),function(t){var e=t?v:p;$.each(e,(function(e,i){var n=P(i,t);n.css({left:M(i.x)+"px",top:M(i.y)+"px",zIndex:i.zIndex}),n.append(i.toHTML()),i.selected&&!t&&S(n.find(".designer-item"))}))}(e)),X(!(e&&t.data&&(t.data.items.length||t.background_url))),t.background_url&&Q(t,e)}function V(t){var e=$(".template-side.back");t.background_url&&(t.background_url=null,e.find(".background-image").remove(),e.append($("<img>",{class:"background-image"}))),e.find(".designer-item").remove(),t.title=null,t.data=null,v={}}function X(t){var e=$(".backside-placeholder");e.parent().toggleClass("empty",t),e.toggle(t),$(".backside-tools").toggleClass("hidden",t)}function Y(t){X(t),$(".backside-tools").toggleClass("hidden",!t),t?($(".backside-placeholder").addClass("to-be-removed"),$(".placeholder-text").html(b.$T.gettext("This back side template will be removed")),$(".placeholder-link").hide(),y=b.$T.gettext("The back side of this template will be removed"),C=b.$T.gettext("Disassociate back side"),T=!0):($(".backside-placeholder").removeClass("to-be-removed"),$(".placeholder-text").html(b.$T.gettext("The back side is empty.")),$(".placeholder-link").show(),y=b.$T.gettext("The back side of the templates that use this one as the back side will be removed."),C=b.$T.gettext("Disassociate back sides"),T=!1)}function Z(t,e,i,n){if($("#backside-warning").length||null!==k){var a=null;$("#backside-warning").length&&null!==k?a=$(".affected-targets-warning"):$("#backside-warning").length?a=$("#backside-warning"):null!==k&&(a=$("#frontside-warning")),50*t.val()!==i?(null!==k&&Y(!0),a.show("fast"),j=!0):50*e.val()===n&&(a.hide("fast"),null!==k&&Y(!1),j=!1)}}function tt(){$("#frontside-warning").hide("fast"),Y(!1),T=!1,j=!1}t.setupDesigner=function(t,l,h,g,f){u=!!t,x=Object.assign(...Object.values(g).map((t=>{let{options:e}=t;return e}))),s=h.zoom_factor,n=M(50),o=n,k=l.id,z=f,$(document).ready((function(){var i=$(".js-remove-bg").qtip();$('#bg-form input[type="file"]').on("change",(function(){var t=$(this);this.files&&t.next("label").removeClass("i-button").text(this.files[0].name),$(".js-upload-bg").attr("disabled",!t.val()).toggleClass("highlight",!!t.val())})),$(".template-content").on("mousedown",".designer-item",(function(){S($(this))})).on("dblclick",".designer-item",(function(){!function(t){var e=E(t);if("fixed"===e.type){var i=prompt("Enter fixed-text value",e.text);if(i){var n=t.parent(".ui-draggable");e.text=i,n.html(e.toHTML())}}}($(this))})),$(".js-upload-bg").click((function(){return $(".js-toggle-side.front").click(),$("#bg-form").submit(),!1})),$("#grid-snap").change((function(){d=this.checked})).change(),$("#bg-form").ajaxForm({dataType:"json",iframe:!1,success:function(e){e.error?alertPopup(e.error,(0,b.$T)("Error")):(t.background_url=e.image_url,Q(t),$(".template-side.front").trigger("indico:backgroundChanged"))}}),$("input[name=bg-position]").change((function(e){e.preventDefault();var i=$(this).val();K($(".template-side.front .background-image"),i),t.data.background_position=i})),$(".js-remove-bg").click((function(e){e.preventDefault(),i.qtip("api").toggle(),function(t){t.background_url&&(t.background_url=null,$(".template-side.front").trigger("indico:backgroundChanged"))}(t)})),$(".move-button").click((function(t){t.preventDefault(),function(t){var i=L(),n=$(".designer-item.selected").parent();({left:function(){n&&(n.css("left",0),i.x=0)},right:function(){if(n){var t=e.width-n.width();n.css("left",t>0?t+"px":0),i.x=D(t>0?t:0)}},center:function(){if(n){var t=(e.width-n.width())/2,a=(e.height-n.height())/2;n.css("left",t>0?t+"px":0),n.css("top",a>0?a+"px":0),i.x=D(t>0?t:0),i.y=D(a>0?a:0)}},top:function(){n&&(n.css("top",0),i.y=0)},bottom:function(){if(n){var t=e.height-n.height();n.css("top",t>0?t+"px":0),i.y=D(t>0?t:0)}},back:function(){if(n){const t=r()(Object.values(p).filter((t=>i.id!==t.id&&N(i,t))),"zIndex"),e=Math.min(i.zIndex,t.zIndex-1);i.zIndex=e,B()}},front:function(){if(n){const t=c()(Object.values(p).filter((t=>i.id!==t.id&&N(i,t))),"zIndex"),e=Math.max(i.zIndex,t.zIndex+1);i.zIndex=e,B()}}})[t]()}($(this).data("direction"))})),$(".js-font-tool").change((function(){G($(this).data("attr"))})),$(".insert-element-btn").click((function(t){var i,a,l;t.preventDefault(),$(".js-toggle-side.front").click(),i=H($("#element-list").val()),a=P(i),l=i.toHTML().appendTo(a),p[i.id]=i,S(l),o+=n,o%=e.height-20})),$(".js-remove-element").click((function(t){var e,i;t.preventDefault(),e=$(".designer-item.selected"),(i=L())&&(delete p[i.id],e.remove(),$(".element-tools").addClass("hidden"))})),$(".js-save-template").click((function(i){i.preventDefault(),function(t){if(""!==$(".js-template-name").val())if(Object.keys(p).length||t.background_url){T&&(k=null);var i={template:{width:e.realWidth,height:e.realHeight,background_position:$("input[name=bg-position]:checked").val(),items:a()(p).map((function(t){return $.extend(!0,{},t).font_size=F(t.font_size),t}))},clear_background:!t.background_url,title:$(".js-template-name").val(),is_clonable:$('input[name="is-clonable"]:checked').length>0,backside_template_id:k};(j?confirmPrompt(b.$T.gettext("Are you sure you want to change the dimensions of this template?")+y,C):$.Deferred().resolve()).then((function(){$.ajax({url:location.pathname,data:JSON.stringify(i),contentType:"application/json",method:"POST",complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError,success:function(t){w=e.width,_=e.height,T&&($(".affected-targets-warning").hide("fast"),Y(!1),$(".js-remove-backside").click(),T=!1,j=!1),handleFlashes(t,!0)}})}))}else alertPopup(b.$T.gettext("The template cannot be empty. Add some elements or a background image."),b.$T.gettext("Warning"));else alertPopup(b.$T.gettext("Please choose a name for the template"),(0,b.$T)("Warning"))}(t)})),$(".template-width, .template-height").on("input",(function(){J(t,l)})),$(".js-element-width").on("keyup click",(function(){G("width")})),$(".js-element-height").on("keyup click",(function(){G("height")})),$("#fixed-text-field").on("keyup",(function(){G("text")})),$(".js-preset-tool").on("change",(function(){var e=$(this).find("option:selected");"custom"!==e.val()&&($(".template-width").val(e.data("width")).change(),$(".template-height").val(e.data("height")).change(),J(t,l)),$(".js-template-dimension").prop("disabled","custom"!==e.val())})),$(".js-toggle-side").on("click",(function(){var t=$(this),e=t.hasClass("front")?"front":"back",i=$(".designer-item.selected"),n=l.data&&(l.data.items.length||l.background_url);$(".template-content").toggleClass("flipped","back"===e),$(".template-side.back").toggleClass("active","back"===e),$(".template-side.front").toggleClass("active","front"===e),$(".backside-tools").toggleClass("hidden","front"===e||!n),$(".js-toggle-side").removeClass("highlight"),$(".element-tools").addClass("hidden"),$(".js-hide-on-flip").toggle("back"!==e),$(".js-invisible-on-flip").toggleClass("disappear","back"===e),t.toggleClass("highlight"),i&&i[0]&&A(i),$(".template-side.active").trigger("indico:backgroundChanged")})),$(".template-side").on("indico:backgroundChanged",(function(){var e=$("#backgroundFile"),i=$(".template-side.front"),n=i.find(".background-image");!t.background_url&&n.attr("src")&&(n.remove(),i.append($("<img>",{class:"background"})),e.val(""),e.next("label").addClass("i-button").text(b.$T.gettext("Choose a file"))),$(".js-upload-bg").attr("disabled",!e.val()),$(".js-remove-bg").attr("disabled",!t.background_url),$("#bg-position-stretch").prop("checked","stretch"===t.data.background_position),$("#bg-position-center").prop("checked","center"===t.data.background_position)})),$(".template-side.front").trigger("indico:backgroundChanged"),$(".template-side.back").on("indico:backsideUpdated",(function(t,e){k=e.backside_template_id,V(l),R(e.template,!0),l=e.template,T&&tt(),$(".backside-template-title, .js-front-affected-title").text(e.template.title)})),$(".js-remove-backside").on("click",(function(){k=null,V(l),T&&tt(),X(!0)})),$(".js-change-orientation").on("click",(function(){var e=$(".template-width"),i=$(".template-height"),n=e.val();e.val(i.val()).change(),i.val(n).change(),J(t,l)})),$(".js-backside-list-dialog").on("click",(function(){var t=$(this);ajaxDialog({trigger:t,url:t.data("href"),data:{width:e.realWidth,height:e.realHeight},title:t.data("title")})})),$(".backside-tools").addClass("hidden");var s=$(".template-width"),h=$(".template-height");s.on("change input",(function(){Z($(this),h,w,_)})),h.on("change input",(function(){Z($(this),s,_,w)})),$(".js-back-affected").qbubble({overwrite:!0,position:{target:$(".js-back-affected")},content:{text:$(".back-warning-qtip-content").html()},hide:{event:"unfocus click"},show:{event:"click"}}),$(".js-front-affected").qbubble({overwrite:!0,position:{target:$(".js-front-affected")},content:{text:function(){return $(".front-warning-qtip-content").html()}},hide:{event:"unfocus click"},show:{event:"click"}})})),u?(e=new W(t.data.width,t.data.height),$(".js-template-name").val(t.title),$(".js-is-clonable").prop("checked",t.is_clonable),$(".template-container").width(e.width).height(e.height)):e=new W(h.tpl_size[0],h.tpl_size[1]),i=new W(0,0),$(".template-width").val(e.width/n),$(".template-height").val(e.height/n),w=e.width,_=e.height,U(),J(t,l),R(t),R(l,!0)}}(window)},4137:t=>{t.exports=function(t,e){return t<e}},2666:(t,e,i)=>{var n=i(11396),a=i(32544),o=i(5850),l=a((function(t,e){n(e,o(e),t)}));t.exports=l},61941:(t,e,i)=>{t.exports=i(2666)},69403:(t,e,i)=>{var n=i(60833),a=i(88904),o=i(4137);t.exports=function(t,e){return t&&t.length?n(t,a(e,2),o):void 0}}},t=>{t.O(0,[8592],(()=>{return e=33832,t(t.s=e);var e}));t.O()}]);
//# sourceMappingURL=module_designer.a7ca7df2.bundle.js.map