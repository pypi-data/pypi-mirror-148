"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[7862],{87862:(e,s,t)=>{t.r(s),t.d(s,{IDocumentProviderFactory:()=>i,ProviderMock:()=>n,WebSocketProvider:()=>q});class n{requestInitialContent(){return Promise.resolve(!1)}putInitializedState(){}acquireLock(){return Promise.resolve(0)}releaseLock(e){}destroy(){}setPath(e){}get renameAck(){return Promise.resolve(!1)}}var c=t(74547);const i=new c.Token("@jupyterlab/docprovider:IDocumentProviderFactory");var o=t(66962),a=t(34571),r=t(90562),h=t(22592),d=t(47941),l=t(83149);const u=new Map,w="undefined"==typeof BroadcastChannel?class{constructor(e){this.room=e,this.onmessage=null,l.z((s=>s.key===e&&null!==this.onmessage&&this.onmessage({data:d.Gh(s.newValue||"")})))}postMessage(e){l.X.setItem(this.room,d.s3(d.eh(e)))}}:BroadcastChannel,_=e=>h.Yu(u,e,(()=>{const s=new Set,t=new w(e);return t.onmessage=e=>s.forEach((s=>s(e.data))),{bc:t,subs:s}})),f=(e,s)=>{const t=_(e);t.bc.postMessage(s),t.subs.forEach((e=>e(s)))};var m=t(2431);const y=(e,s)=>{a.uE(e,0);const t=r.encodeStateVector(s);a.mP(e,t)},p=(e,s,t)=>{a.uE(e,1),a.mP(e,r.encodeStateAsUpdate(s,t))},b=(e,s,t)=>{try{r.applyUpdate(s,o.HN(e),t)}catch(e){console.error("Caught error while handling a Yjs update",e)}},g=b;var v=t(90157),C=t(94236),U=t(12330),I=t(11182),k=t(36498),M=t(27061);const E=[];E[0]=(e,s,t,n,c)=>{a.uE(e,0);const i=((e,s,t,n)=>{const c=o.yg(e);switch(c){case 0:((e,s,t)=>{p(s,t,o.HN(e))})(e,s,t);break;case 1:b(e,t,n);break;case 2:g(e,t,n);break;default:throw new Error("Unknown message type")}return c})(s,e,t.doc,t);n&&1===i&&!t.synced&&(t.synced=!0)},E[3]=(e,s,t,n,c)=>{a.uE(e,1),a.mP(e,v.xq(t.awareness,Array.from(t.awareness.getStates().keys())))},E[1]=(e,s,t,n,c)=>{v.oy(t.awareness,o.HN(s),t)},E[2]=(e,s,t,n,c)=>{((e,s,t)=>{0===o.yg(e)&&t(s,o.kf(e))})(s,t.doc,P)};const P=(e,s)=>console.warn(`Permission denied to access ${e.url}.\n${s}`),S=(e,s,t)=>{const n=o.l1(s),c=a.Mf(),i=o.yg(n),r=e.messageHandlers[i];return r?r(c,n,e,t,i):console.error("Unable to compute message"),c},R=e=>{if(e.shouldConnect&&null===e.ws){const s=new e._WS(e.url);s.binaryType="arraybuffer",e.ws=s,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,s.onmessage=t=>{e.wsLastMessageReceived=m.ZG();const n=S(e,new Uint8Array(t.data),!0);a.kE(n)>1&&s.send(a._f(n))},s.onclose=()=>{e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,v.Ag(e.awareness,Array.from(e.awareness.getStates().keys()).filter((s=>s!==e.doc.clientID)),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(R,I.VV(1200*I.mv(e.wsUnsuccessfulReconnects+1),2500),e)},s.onopen=()=>{e.wsLastMessageReceived=m.ZG(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const t=a.Mf();if(a.uE(t,0),y(t,e.doc),s.send(a._f(t)),null!==e.awareness.getLocalState()){const t=a.Mf();a.uE(t,1),a.mP(t,v.xq(e.awareness,[e.doc.clientID])),s.send(a._f(t))}},e.emit("status",[{status:"connecting"}])}},H=(e,s)=>{e.wsconnected&&e.ws.send(s),e.bcconnected&&e.mux((()=>{f(e.bcChannel,s)}))};class A extends U.y{constructor(e,s,t,{connect:n=!0,awareness:c=new v.GL(t),params:i={},WebSocketPolyfill:o=WebSocket,resyncInterval:r=-1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);const h=(e=>k.UI(e,((e,s)=>`${encodeURIComponent(s)}=${encodeURIComponent(e)}`)).join("&"))(i);this.bcChannel=e+"/"+s,this.url=e+"/"+s+(0===h.length?"":"?"+h),this.roomname=s,this.doc=t,this._WS=o,this.awareness=c,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.wsUnsuccessfulReconnects=0,this.messageHandlers=E.slice(),this.mux=C.M(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=n,this._resyncInterval=0,r>0&&(this._resyncInterval=setInterval((()=>{if(this.ws){const e=a.Mf();a.uE(e,0),y(e,t),this.ws.send(a._f(e))}}),r)),this._bcSubscriber=e=>{this.mux((()=>{const s=S(this,new Uint8Array(e),!1);a.kE(s)>1&&f(this.bcChannel,a._f(s))}))},this._updateHandler=(e,s)=>{if(s!==this){const s=a.Mf();a.uE(s,0),((e,s)=>{a.uE(e,2),a.mP(e,s)})(s,e),H(this,a._f(s))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:s,removed:t},n)=>{const i=e.concat(s).concat(t),o=a.Mf();a.uE(o,1),a.mP(o,v.xq(c,i)),H(this,a._f(o))},this._beforeUnloadHandler=()=>{v.Ag(this.awareness,[t.clientID],"window unload")},"undefined"!=typeof window?window.addEventListener("beforeunload",this._beforeUnloadHandler):void 0!==M&&M.on("exit",(()=>this._beforeUnloadHandler)),c.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval((()=>{this.wsconnected&&3e4<m.ZG()-this.wsLastMessageReceived&&this.ws.close()}),3e3),n&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),"undefined"!=typeof window?window.removeEventListener("beforeunload",this._beforeUnloadHandler):void 0!==M&&M.off("exit",(()=>this._beforeUnloadHandler)),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){var e,s;this.bcconnected||(e=this.bcChannel,s=this._bcSubscriber,_(e).subs.add(s),this.bcconnected=!0),this.mux((()=>{const e=a.Mf();a.uE(e,0),y(e,this.doc),f(this.bcChannel,a._f(e));const s=a.Mf();a.uE(s,0),p(s,this.doc),f(this.bcChannel,a._f(s));const t=a.Mf();a.uE(t,3),f(this.bcChannel,a._f(t));const n=a.Mf();a.uE(n,1),a.mP(n,v.xq(this.awareness,[this.doc.clientID])),f(this.bcChannel,a._f(n))}))}disconnectBc(){const e=a.Mf();var s,t;a.uE(e,1),a.mP(e,v.xq(this.awareness,[this.doc.clientID],new Map)),H(this,a._f(e)),this.bcconnected&&(s=this.bcChannel,t=this._bcSubscriber,_(s).subs.delete(t),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(R(this),this.connectBc())}}class q extends A{constructor(e){super(e.url,e.contentType+":"+e.path,e.ymodel.ydoc,{awareness:e.ymodel.awareness}),this._initialContentRequest=null,this._path=e.path,this._contentType=e.contentType,this._serverUrl=e.url,this.messageHandlers[127]=(e,s,t,n,c)=>{const i=o.iU(s);i.byteLength>0&&r.applyUpdate(this.doc,i);const a=this._initialContentRequest;this._initialContentRequest=null,a&&a.resolve(i.byteLength>0)},this.messageHandlers[125]=(e,s,t,n,c)=>{this._renameAck.resolve(!!o.iU(s)[0])},this._isInitialized=!1,this._onConnectionStatus=this._onConnectionStatus.bind(this),this.on("status",this._onConnectionStatus);const s=e.ymodel.awareness,t=e.user,n=()=>{const e=""!==t.displayName?t.displayName:t.name;s.setLocalStateField("user",Object.assign(Object.assign({},t.toJSON()),{name:e}))};t.isReady&&n(),t.ready.connect(n),t.changed.connect(n)}get renameAck(){return this._renameAck.promise}setPath(e){if(e!==this._path){this._path=e;const s=a.Mf();this._renameAck=new c.PromiseDelegate,a.cW(s,125);const t=unescape(encodeURIComponent(this._contentType+":"+e));for(let e=0;e<t.length;e++)a.cW(s,t.codePointAt(e));this._sendMessage(a._f(s)),this.disconnectBc(),this.bcChannel=this._serverUrl+"/"+this._contentType+":"+this._path,this.url=this.bcChannel,this.connectBc()}}requestInitialContent(){return this._initialContentRequest||(this._initialContentRequest=new c.PromiseDelegate,this._sendMessage(new Uint8Array([127])),setTimeout((()=>{var e;return null===(e=this._initialContentRequest)||void 0===e?void 0:e.resolve(!1)}),1e3)),this._initialContentRequest.promise}putInitializedState(){const e=a.Mf();a.uE(e,126),a.HK(e,r.encodeStateAsUpdate(this.doc)),this._sendMessage(a._f(e)),this._isInitialized=!0}_sendMessage(e){const s=()=>{setTimeout((()=>{this.wsconnected?this.ws.send(e):this.once("status",s)}),0)};s()}async _onConnectionStatus(e){this._isInitialized&&"connected"===e.status&&(await this.requestInitialContent()||this.putInitializedState())}}},94236:(e,s,t)=>{t.d(s,{M:()=>n});const n=()=>{let e=!0;return(s,t)=>{if(e){e=!1;try{s()}finally{e=!0}}else void 0!==t&&t()}}}}]);